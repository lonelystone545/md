[阿里巴巴为什么不用 ZooKeeper 做服务发现？](http://jm.taobao.org/2018/06/13/%E5%81%9A%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%EF%BC%9F/)

# zookeeper和Eureka
zk遵守CP原则，而eureka遵守AP原则。
1.1当向注册中心查询服务列表时，我们可以容忍注册中心返回的是几分钟以前的注册信息，
  但不能接受服务直接down掉不可用。也就是说，服务注册功能对可用性的要求高于一致性。
  但是zk会出现这一种情况，当master节点因为网络故障与其他节点失去联系时，剩余注册
  功能就会重新进行leader选举看。问题在于，选举leader的时间太长，30~120s，且选举期间
  整个zk集群都是不可用的，这就导致在选举期间注册服务瘫痪。在云部署的环境下，因网络问题
  使得zk集群失去master节点是较大概率会发生的事，虽然服务能够最终恢复，但是漫长的
  选举时间导致的注册长期不可用是不能容忍的。
        1.2Eureka看明白了这一点，因此在设计时就优先保证可用性。Eureka各个节点都是平等
  的，几个节点挂掉不会影响正常节点的工作，剩余节点依然可以提供注册和查询服务。
  而Eureka的客户端在向某个Eureka注册或者如果发现链接失败时，则会自动切换至其他节点，
  只要有一台Eureka还在，就能保证注册服务可用（保证可用），只不过查到的信息可能不是
  最新的（不保证一致性）。除此以外，Eureka还有一种自我保护机制，如果在15分钟内超过85%
  的节点都没有正常的心跳，那么Eureka就认为客户端与注册中心出现了网络故障，此时会出现
  一下几种情况：
      （1）Eureka不在从注册列表中移除因为长时间没收到心跳而应该过期的服务
      （2）Eureka仍然能够接受新服务的注册和查询请求，但是不会被同步到其他节点上
               （保证当前节点依然可用）
      （3）当网络稳定时，当前实例新的注册信息会被同步到其他节点中
  因此，Eureka可以很好的应对因网络故障导致部分节点失去联系的情况，而不会像zk那样
     是整个注册服务瘫痪。
     
     如果给ZooKeeper加上客户端缓存（注：给ZooKeeper节点配上本地缓存）或者其他类似技术的话可以缓解ZooKeeper因为网络故障造成节点同步信息错误的问题。Pinterest与Airbnb公司就使用了这个方法来防止ZooKeeper故障发生。这种方式可以从表面上解决这个问题，具体地说，当部分或者所有节点跟ZooKeeper断开的情况下，每个节点还可以从本地缓存中获取到数据；但是，即便如此，ZooKeeper下所有节点不可能保证任何时候都能缓存所有的服务注册信息。如果ZooKeeper下所有节点都断开了，或者集群中出现了网络分割的故障（注：由于交换机故障导致交换机底下的子网间不能互访）；那么ZooKeeper会将它们都从自己管理范围中剔除出去，外界就不能访问到这些节点了，即便这些节点本身是“健康”的，可以正常提供服务的；所以导致到达这些节点的服务请求被丢失了。（注：这也是为什么ZooKeeper不满足CAP中A的原因）

