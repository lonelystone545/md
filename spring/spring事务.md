[TOC]
# spring多线程事务
spring事务是线程级别的，通过threadLocal保存，因此事务的传播也只能在同一个线程调用多个事务方法时才有意义。如果在事务方法的主线程中，开启子线程执行新的事务方法，此时子线程的事务是新开一个事务，而不会和主线程共享一个事务。
如果采用编程式事务，需要手动开启事务、提交和回滚。

# spring事务原理
如何保证事务的开启、提交和回滚使用同一个数据源连接呢？--threadLocal。
对声明式注解@Transactional标记的方法，那代理方法首先执行增强，判断当前线程是否存在connection，不存在则新建并绑定到当前线程(通过threadLocal进行绑定)，然后通过反射执行目标方法，最后回到代理方法执行增强，如提交回滚和归还连接到连接池等。